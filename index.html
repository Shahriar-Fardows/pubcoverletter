<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Assignment Cover Page Generator</title>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7ZV70MZE13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-7ZV70MZE13');
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
      @page {
          size: A4;
          margin: 0;
      }
      
      .a4-page {
          width: 210mm;
          height: 297mm;
          margin: 0 auto;
          background: white;
          position: relative;
      }

      .page-content {
          border: 2px dashed #9ca3af;
          margin: 8mm;
          height: 277mm;
          position: relative;
      }

      @media print {
          html, body {
              width: 100%;
              height: 100%;
              margin: 0;
              padding: 0;
              background: white;
          }
          .no-print {
              display: none !important;
          }
          .a4-page {
              margin: 0;
              padding: 0;
              box-shadow: none !important;
              width: 100%;
              height: 100%;
          }
          .page-content {
              border: 2px dashed #9ca3af !important;
              margin: 8mm !important;
              height: calc(100% - 16mm) !important;
              width: calc(100% - 16mm) !important;
          }
          .content-wrapper {
              height: 100% !important;
          }
          .navbar {
              display: none !important;
          }
      }

      .form-container {
          max-width: 210mm;
          margin: 2rem auto;
      }

      .print-button-disabled {
          background-color: #9ca3af !important;
          cursor: not-allowed !important;
      }

      .student-id-error {
          border-color: #ef4444 !important;
          background-color: #fef2f2 !important;
      }

      .validation-message {
          font-size: 0.875rem;
          margin-top: 0.25rem;
      }
  </style>
</head>
<body class="bg-gray-100">
   <nav class="bg-white shadow-md navbar">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between h-16">
              <!-- Logo and site name -->
              <div class="flex items-center">
                  <div class="flex-shrink-0 flex items-center">
                      <span class="text-blue-600 font-bold text-xl">Academic Tools</span>
                  </div>
              </div>
              
              <!-- Desktop menu -->
              <div class="hidden md:flex md:items-center md:space-x-6">
                  <a href="https://pubfees.netlify.app/" class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200">
                      Semester Fee Calculator
                  </a>
                  <a href="https://pubcoverletter.netlify.app/" class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200">
                      Cover Page Generator
                  </a>
                  <a href="https://pubadvisor.netlify.app/" class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200">
                      Academic Advisor
                  </a>
              </div>
              
              <!-- Mobile menu button -->
              <div class="flex md:hidden items-center">
                  <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-blue-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500">
                      <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                      </svg>
                  </button>
              </div>
          </div>
      </div>

      <!-- Mobile menu, show/hide based on menu state -->
      <div id="mobile-menu" class="md:hidden hidden">
          <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
              <a href="https://pubfees.netlify.app/" class="block text-gray-700 hover:text-blue-600 hover:bg-gray-50 px-3 py-2 rounded-md text-base font-medium">
                  Semester Fee Calculator
              </a>
              <a href="https://pubcoverletter.netlify.app/" class="block text-gray-700 hover:text-blue-600 hover:bg-gray-50 px-3 py-2 rounded-md text-base font-medium">
                  Cover Page Generator
              </a>
              <a href="https://pubadvisor.netlify.app/" class="block text-gray-700 hover:text-blue-600 hover:bg-gray-50 px-3 py-2 rounded-md text-base font-medium">
                  Academic Advisor
              </a>
          </div>
      </div>
  </nav>

  
  <!-- Form Section -->
  <div class="form-container no-print bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-2xl font-bold mb-4 text-center">Assignment Cover Page Generator</h2>
      
      <form id="coverPageForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Assignment Title -->
          <div class="md:col-span-2">
              <label for="assignmentTitle" class="block text-sm font-medium text-gray-700 mb-1">Assignment Title:</label>
              <input type="text" id="assignmentTitle" class="w-full p-2 border border-gray-300 rounded" value="ASSIGNMENT">
              <p class="text-xs text-gray-500 mt-1">This text will appear as the title of your cover page</p>
          </div>
          
          <div>
              <label for="courseName" class="block text-sm font-medium text-gray-700 mb-1">Course Name:</label>
              <input type="text" id="courseName" class="w-full p-2 border border-gray-300 rounded" value="Calculus I">
          </div>
          <div>
              <label for="courseCode" class="block text-sm font-medium text-gray-700 mb-1">Course Code:</label>
              <input type="text" id="courseCode" class="w-full p-2 border border-gray-300 rounded">
          </div>
          <div>
              <label for="submissionDate" class="block text-sm font-medium text-gray-700 mb-1">Submission Date:</label>
              <input type="date" id="submissionDate" class="w-full p-2 border border-gray-300 rounded">
              <div class="mt-1">
                  <label class="inline-flex items-center">
                      <input type="checkbox" id="noSubmissionDate" class="form-checkbox">
                      <span class="ml-2 text-sm text-gray-600">Leave blank</span>
                  </label>
              </div>
          </div>
          <div>
              <label for="studentName" class="block text-sm font-medium text-gray-700 mb-1">Student Name:</label>
              <input type="text" id="studentName" class="w-full p-2 border border-gray-300 rounded">
          </div>
          <div>
              <label for="studentId" class="block text-sm font-medium text-gray-700 mb-1">Student ID: <span class="text-red-500">*</span></label>
              <input type="text" id="studentId" class="w-full p-2 border border-gray-300 rounded" required>
              <div id="studentIdValidation" class="validation-message hidden"></div>
          </div>
          <div>
              <label for="section" class="block text-sm font-medium text-gray-700 mb-1">Section:</label>
              <input type="text" id="section" class="w-full p-2 border border-gray-300 rounded">
          </div>
          <div>
              <label for="teacherName" class="block text-sm font-medium text-gray-700 mb-1">Teacher Name:</label>
              <input type="text" id="teacherName" class="w-full p-2 border border-gray-300 rounded">
          </div>
          <div>
              <label for="teacherPosition" class="block text-sm font-medium text-gray-700 mb-1">Teacher Position:</label>
              <input type="text" id="teacherPosition" class="w-full p-2 border border-gray-300 rounded" value="Lecturer">
          </div>
          <div>
              <label for="department" class="block text-sm font-medium text-gray-700 mb-1">Department:</label>
              <input type="text" id="department" class="w-full p-2 border border-gray-300 rounded" 
                     value="Computer Science and Engineering" 
                     placeholder="Computer Science and Engineering">
          </div>
          <div class="md:col-span-2 flex justify-center gap-4 mt-4">
              <button type="button" id="previewButton" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">
                  Preview
              </button>
              <button type="button" id="printButton" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 print-button-disabled" disabled>
                  Print Cover Page
              </button>
          </div>
      </form>
  </div>

  <!-- A4 Page Preview -->
  <div id="coverPagePreview" class="a4-page shadow-lg">
      <div class="page-content">
          <div class="content-wrapper flex flex-col justify-between h-full py-12 px-8">
              <!-- University Logo and Header -->
              <div class="space-y-8">
                  <!-- University Logo -->
                  <div>
                    <div class="flex justify-center">
                      <img src="./logo.svg" 
                           alt="Presidency University Logo" 
                           class="h-40 object-contain">     
                  </div>
                  <h1 class="text-3xl font-bold text-center text-[#9e1d21]">Presidency <span class="text-[#18457b]"> University</span></h1>
                  </div>

                  <!-- Assignment Title -->
                  <div class="text-center">
                      <h1 class="text-3xl underline" id="displayAssignmentTitle">ASSIGNMENT</h1>
                  </div>

                  <!-- Course Information -->
                  <div class="space-y-3 text-center">
                      <p class="text-xl"><span class="font-semibold">Course Name:</span> <span id="displayCourseName">Calculus I</span></p>
                      <p class="text-xl"><span class="font-semibold">Course code:</span> <span id="displayCourseCode">MAT123</span></p>
                      <p class="text-xl"><span class="font-semibold">Submission Date:</span> <span id="displaySubmissionDate">22/02/2025</span></p>
                  </div>
              </div>

              <!-- Middle Section -->
              <div class="space-y-12">
                  <!-- Submitted by Section -->
                  <div class="text-center space-y-2">
                      <p class="text-xl italic mb-3">Submitted by</p>
                      <p class="text-xl font-bold" id="displayStudentName">JANNATUN NAEEM</p>
                      <p class="text-xl"><span class="font-semibold">Student ID:</span> <span id="displayStudentId">242241038</span></p>
                      <p class="text-xl"><span class="font-semibold">Section:</span> <span id="displaySection">2</span></p>
                  </div>

                  <!-- Submitted to Section -->
                  <div class="text-center space-y-2">
                      <p class="text-xl italic mb-3">Submitted to</p>
                      <p class="text-xl font-bold" id="displayTeacherName">NAFIA MOLLIK</p>
                      <p class="text-xl" id="displayTeacherPosition">Lecturer</p>
                      <p class="text-xl">Presidency University</p>
                  </div>
              </div>

              <!-- Bottom Section -->
              <div class="text-center space-y-2">
                  <p class="text-xl">Department of <span id="displayDepartment">Computer Science and Engineering</span></p>
                  <p class="text-xl font-semibold">Presidency University</p>
              </div>
          </div>
      </div>
  </div>

  <script>

      // Disable Ctrl+P
      document.addEventListener('keydown', function(e) {
          // Disable Ctrl+P
          if (e.ctrlKey && e.key === 'p') {
              e.preventDefault();
              alert('Please use the Print button to generate your cover page.');
              return false;
          }
          
          // Disable F12, Ctrl+Shift+I, Ctrl+U (optional security)
          if (e.key === 'F12' || 
              (e.ctrlKey && e.shiftKey && e.key === 'I') || 
              (e.ctrlKey && e.key === 'u')) {
              e.preventDefault();
              return false;
          }
      });

      // Disable right-click context menu (optional)
      document.addEventListener('contextmenu', function(e) {
          e.preventDefault();
      });

      // Toggle mobile menu
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      
      mobileMenuButton.addEventListener('click', () => {
          mobileMenu.classList.toggle('hidden');
      });
      
      // SheetDB API endpoints for data saving
      const sheetDbApis = [
          'https://sheetdb.io/api/v1/5m1omtva8avsk',
          'https://sheetdb.io/api/v1/61kyqimj66opr',
          'https://sheetdb.io/api/v1/0lbjvqvqaht7u',
          'https://sheetdb.io/api/v1/y3v109nzuzvwf',
          'https://sheetdb.io/api/v1/xut3wtv9lzil4'
      ];

      // Blocked Students API
      const blockedStudentsApi = 'https://sheetdb.io/api/v1/p4r5sob7dibm1';
      
      // API usage tracking
      let apiUsageCounts = {};
      
      // Blocked students cache system with custom alert messages
      let blockedStudentsCache = {
          data: new Map(), // Changed to Map to store both ID and alert message
          lastFetched: null,
          cacheExpiry: 30 * 60 * 1000, // 30 minutes cache
          isLoading: false
      };
      
      // Validation state management
      let validationState = {
          isValidating: false,
          lastValidatedId: null,
          isValid: false
      };
      
      // Initialize API usage from localStorage if available
      function initializeApiUsage() {
          const savedUsage = localStorage.getItem('apiUsageCounts');
          if (savedUsage) {
              apiUsageCounts = JSON.parse(savedUsage);
          } else {
              // Initialize with zero counts
              sheetDbApis.forEach(api => {
                  apiUsageCounts[api] = 0;
              });
              saveApiUsage();
          }
      }
      
      // Save API usage to localStorage
      function saveApiUsage() {
          localStorage.setItem('apiUsageCounts', JSON.stringify(apiUsageCounts));
      }
      
      // Get next available API endpoint
      function getNextAvailableApi() {
          for (const api of sheetDbApis) {
              if (!apiUsageCounts[api] || apiUsageCounts[api] < 500) {
                  return api;
              }
          }
          return sheetDbApis[0];
      }
      
      // Increment API usage count
      function incrementApiUsage(api) {
          if (!apiUsageCounts[api]) {
              apiUsageCounts[api] = 0;
          }
          apiUsageCounts[api]++;
          saveApiUsage();
      }
      
      // Function to log errors silently
      function logError(message, error) {
          console.error(`[${new Date().toISOString()}] ${message}`, error);
      }

      // Load blocked students from API with custom alert messages
      async function loadBlockedStudents() {
          const now = Date.now();
          
          if (blockedStudentsCache.lastFetched && 
              (now - blockedStudentsCache.lastFetched) < blockedStudentsCache.cacheExpiry) {
              console.log('Using cached blocked students data');
              return true;
          }

          if (blockedStudentsCache.isLoading) {
              console.log('Already loading blocked students...');
              return false;
          }

          try {
              blockedStudentsCache.isLoading = true;
              console.log('Fetching blocked students from API...');
              
              const response = await fetch(blockedStudentsApi);
              
              if (!response.ok) {
                  throw new Error(`API responded with status ${response.status}`);
              }
              
              const data = await response.json();
              
              blockedStudentsCache.data.clear();
              
              if (Array.isArray(data)) {
                  data.forEach(item => {
                      const studentId = item.StudentId || item.studentId || item.student_id || item.id;
                      const alertMessage = item.alart || item.alert || item.message || '';
                      
                      if (studentId) {
                          blockedStudentsCache.data.set(studentId.toString().trim(), alertMessage);
                      }
                  });
              }
              
              blockedStudentsCache.lastFetched = now;
              
              console.log(`Loaded ${blockedStudentsCache.data.size} blocked student IDs with custom messages`);
              return true;
              
          } catch (error) {
              logError('Error loading blocked students', error);
              return false;
          } finally {
              blockedStudentsCache.isLoading = false;
          }
      }

      // Check if a student ID is blocked and get custom message
      function getBlockedStudentInfo(studentId) {
          if (!studentId) return null;
          
          const trimmedId = studentId.toString().trim();
          if (blockedStudentsCache.data.has(trimmedId)) {
              const customMessage = blockedStudentsCache.data.get(trimmedId);
              return {
                  isBlocked: true,
                  message: customMessage || 'Access denied: This Student ID has been restricted from using this service'
              };
          }
          
          return { isBlocked: false, message: '' };
      }

      // Enhanced student ID validation with custom alert messages
      async function validateStudentAccess(studentId) {
          if (!studentId || studentId.trim().length === 0) {
              return { valid: false, message: 'Student ID is required' };
          }
          
          const trimmedId = studentId.trim();
          
          const formatCheck = /^\d{6,12}$/.test(trimmedId);
          if (!formatCheck) {
              return { valid: false, message: 'Invalid Student ID format (6-12 digits required)' };
          }

          await loadBlockedStudents();
          
          const blockedInfo = getBlockedStudentInfo(trimmedId);
          
          if (blockedInfo.isBlocked) {
              return { 
                  valid: false, 
                  message: blockedInfo.message
              };
          }
          
          return { 
              valid: true, 
              message: 'Valid Student ID' 
          };
      }
      
      // Update UI based on validation result
      function updateValidationUI(result, studentId) {
          const studentIdInput = document.getElementById('studentId');
          const validationMessage = document.getElementById('studentIdValidation');
          const printButton = document.getElementById('printButton');
          
          studentIdInput.classList.remove('student-id-error');
          validationMessage.classList.add('hidden');
          validationMessage.classList.remove('text-red-600', 'text-green-600');
          
          if (studentId && studentId.trim().length > 0) {
              if (result.valid) {
                  validationMessage.textContent = 'âœ“ Valid Student ID';
                  validationMessage.classList.remove('hidden');
                  validationMessage.classList.add('text-green-600');
                  
                  printButton.disabled = false;
                  printButton.classList.remove('print-button-disabled');
                  
                  validationState.isValid = true;
              } else {
                  studentIdInput.classList.add('student-id-error');
                  validationMessage.textContent = result.message;
                  validationMessage.classList.remove('hidden');
                  validationMessage.classList.add('text-red-600');
                  
                  printButton.disabled = true;
                  printButton.classList.add('print-button-disabled');
                  
                  validationState.isValid = false;
              }
          } else {
              printButton.disabled = true;
              printButton.classList.add('print-button-disabled');
              validationState.isValid = false;
          }
          
          validationState.lastValidatedId = studentId;
      }
      
      // Debounced validation function
      let validationTimeout;
      async function debouncedValidation(studentId) {
          clearTimeout(validationTimeout);
          
          validationTimeout = setTimeout(async () => {
              if (validationState.isValidating) return;
              
              validationState.isValidating = true;
              const result = await validateStudentAccess(studentId);
              updateValidationUI(result, studentId);
              validationState.isValidating = false;
          }, 800);
      }
      
      // Function to save data to Google Sheets via SheetDB
      async function saveToGoogleSheets() {
          try {
              const assignmentTitle = document.getElementById('assignmentTitle').value;
              const studentId = document.getElementById('studentId').value;
              const studentName = document.getElementById('studentName').value;
              const section = document.getElementById('section').value;
              const department = document.getElementById('department').value;
              const courseName = document.getElementById('courseName').value;
              const courseCode = document.getElementById('courseCode').value;
              const teacherName = document.getElementById('teacherName').value;
              const teacherPosition = document.getElementById('teacherPosition').value;
              
              const data = {
                  assignmentTitle: assignmentTitle || 'ASSIGNMENT',
                  studentId: studentId || 'Not provided',
                  studentName: studentName || 'Not provided',
                  section: section || 'Not provided',
                  department: department || 'Computer Science and Engineering',
                  courseName: courseName || 'Not provided',
                  courseCode: courseCode || 'Not provided',
                  teacherName: teacherName || 'Not provided',
                  teacherPosition: teacherPosition || 'Lecturer',
                  createDate: new Date().toLocaleDateString('en-GB')
              };
              
              const apiEndpoint = getNextAvailableApi();
              
              fetch(apiEndpoint, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({ data: [data] })
              })
              .then(response => {
                  if (response.ok) {
                      incrementApiUsage(apiEndpoint);
                      console.log('Data saved successfully!');
                      return response.json();
                  } else {
                      return response.json().then(errorData => {
                          throw new Error(`API responded with status ${response.status}: ${JSON.stringify(errorData)}`);
                      });
                  }
              })
              .then(responseData => {
                  console.log('API response:', responseData);
              })
              .catch(error => {
                  logError('Error saving data to SheetDB', error);
                  
                  const currentIndex = sheetDbApis.indexOf(apiEndpoint);
                  if (currentIndex >= 0 && currentIndex < sheetDbApis.length - 1) {
                      const nextApi = sheetDbApis[currentIndex + 1];
                      console.log(`Retrying with next API: ${nextApi}`);
                      
                      fetch(nextApi, {
                          method: 'POST',
                          headers: {
                              'Content-Type': 'application/json'
                          },
                          body: JSON.stringify({ data: [data] })
                      })
                      .then(response => {
                          if (response.ok) {
                              incrementApiUsage(nextApi);
                              console.log('Data saved successfully with backup API!');
                          } else {
                              throw new Error(`Backup API responded with status ${response.status}`);
                          }
                      })
                      .catch(backupError => {
                          logError('Error saving data with backup API', backupError);
                      });
                  }
              });
              
          } catch (error) {
              logError('Error in saveToGoogleSheets function', error);
          }
      }
      
      // Function to format date as DD/MM/YYYY
      function formatDate(dateString) {
          if (!dateString) return '';
          const date = new Date(dateString);
          return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
      }

      // Function to update the preview
      function updatePreview() {
          const assignmentTitle = document.getElementById('assignmentTitle').value || 'ASSIGNMENT';
          const courseName = document.getElementById('courseName').value || 'Calculus I';
          const courseCode = document.getElementById('courseCode').value || 'MAT123';
          const submissionDate = document.getElementById('submissionDate').value;
          const noSubmissionDate = document.getElementById('noSubmissionDate').checked;
          const studentName = document.getElementById('studentName').value || 'JANNATUN NAEEM';
          const studentId = document.getElementById('studentId').value || '242241038';
          const section = document.getElementById('section').value || '2';
          const teacherName = document.getElementById('teacherName').value || 'NAFIA MOLLIK';
          const teacherPosition = document.getElementById('teacherPosition').value || 'Lecturer';
          const department = document.getElementById('department').value || 'Computer Science and Engineering';

          document.getElementById('displayAssignmentTitle').textContent = assignmentTitle;
          document.getElementById('displayCourseName').textContent = courseName;
          document.getElementById('displayCourseCode').textContent = courseCode;
          
          if (noSubmissionDate) {
              document.getElementById('displaySubmissionDate').textContent = '';
          } else {
              document.getElementById('displaySubmissionDate').textContent = submissionDate ? formatDate(submissionDate) : '22/02/2025';
          }
          
          document.getElementById('displayStudentName').textContent = studentName;
          document.getElementById('displayStudentId').textContent = studentId;
          document.getElementById('displaySection').textContent = section;
          document.getElementById('displayTeacherName').textContent = teacherName;
          document.getElementById('displayTeacherPosition').textContent = teacherPosition;
          document.getElementById('displayDepartment').textContent = department;
      }

      // Track form field changes for analytics
      function trackFormFieldChange(fieldName) {
          gtag('event', 'form_field_change', {
              'field_name': fieldName,
              'page_title': 'Cover Page Generator'
          });
      }

      // Add event listeners to form inputs
      document.querySelectorAll('#coverPageForm input').forEach(input => {
          input.addEventListener('input', updatePreview);
          input.addEventListener('change', updatePreview);
          
          input.addEventListener('change', function() {
              trackFormFieldChange(this.id);
          });
      });

      // Student ID specific validation
      document.getElementById('studentId').addEventListener('input', function() {
          const studentId = this.value.trim();
          debouncedValidation(studentId);
          updatePreview();
      });

      // Preview button functionality with analytics
      document.getElementById('previewButton').addEventListener('click', function() {
          gtag('event', 'preview_cover_page', {
              'event_category': 'engagement',
              'event_label': 'Preview Cover Page'
          });
          
          document.getElementById('coverPagePreview').scrollIntoView({ behavior: 'smooth' });
      });

      // Enhanced print button functionality
      document.getElementById('printButton').addEventListener('click', async function() {
          if (this.disabled) {
              return;
          }
          
          const studentId = document.getElementById('studentId').value.trim();
          
          if (!studentId) {
              alert('Please enter a valid Student ID before printing.');
              return;
          }
          
          if (!validationState.isValid || validationState.lastValidatedId !== studentId) {
              const result = await validateStudentAccess(studentId);
              if (!result.valid) {
                  alert('Cannot print: ' + result.message);
                  return;
              }
          }
          
          saveToGoogleSheets();
          
          gtag('event', 'generate_cover_page', {
              'event_category': 'conversion',
              'event_label': 'Print Cover Page'
          });
          
          window.print();
      });

      // Set today's date as default
      const today = new Date();
      const formattedDate = today.toISOString().substr(0, 10);
      document.getElementById('submissionDate').value = formattedDate;
      
      // Track page load
      gtag('event', 'page_view', {
          page_title: 'Assignment Cover Page Generator',
          page_location: window.location.href,
          page_path: window.location.pathname
      });
      
      // Initialize everything
      initializeApiUsage();
      updatePreview();
      updateValidationUI({ valid: false, message: 'Student ID required' }, '');

      // Pre-load blocked students on page load
      document.addEventListener('DOMContentLoaded', () => {
          loadBlockedStudents().catch(error => {
              console.log('Failed to pre-load blocked students:', error);
          });
      });
  </script>
</body>
</html>